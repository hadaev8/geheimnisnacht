
# New Druchii Feast events
# Re-flavour of the vanilla Kali Puja feast
# need make something better then copied vanilla events
namespace = druchii_feast

# Late night talk: First person
character_event = {
	id = druchii_feast.23
	desc = EVTDESCDRUCHIFEAST.23 # Late at night, you speak to one of your guests and find that this is an amazing individual. You talk late into the night, plotting together and coming up with ways to achieve both your goals...
	picture = "GFX_evt_large_army"
	min_age = 16
	capable_only = yes
	prisoner = no
	has_character_flag = attending_druchii_feast
	war = no

	trigger = {
		NOT = {
			num_of_friends = 3
		}
		any_realm_character = {
			has_character_flag = attending_druchii_feast
			same_liege = ROOT
			is_adult = yes
			liege = {
				NOT = {
					had_character_flag = {
						flag = holding_large_druchi_feast
						days = 30
					}
				}
				has_character_flag = holding_large_druchi_feast
				has_character_modifier = holding_large_druchi_feast
			}
			nor = {
				num_of_friends = 3
				character = ROOT
				any_claim = {
					holder_scope = {
						character = ROOT
					}
				}
				ROOT = {
					any_claim = {
						holder_scope = {
							character = PREVPREV
						}
					}
				}
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_friend
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 200
		modifier = {
			factor = 0.5
			trait = gregarious
		}
		modifier = {
			factor = 0.5
			trait = trusting
		}
		modifier = {
			factor = 2
			trait = shy
		}
		modifier = {
			factor = 2
			trait = paranoid
		}
	}

	immediate = {
		log = "work event id = druchii_feast.23 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTDRUCHIFEAST.23.a # I have made a new ally tonight!
		random_realm_character = {
			limit = {
				has_character_flag = attending_druchii_feast
				same_liege = ROOT
				is_adult = yes
				liege = {
					NOT = {
						had_character_flag = {
							flag = holding_large_druchi_feast
							days = 30
						}
					}
					has_character_flag = holding_large_druchi_feast
					has_character_modifier = holding_large_druchi_feast
				}
				nor = {
					num_of_friends = 3
					character = ROOT
					any_claim = {
						holder_scope = {
							character = ROOT
						}
					}
					ROOT = {
						any_claim = {
							holder_scope = {
								character = PREVPREV
							}
						}
					}
					has_opinion_modifier = {
						who = ROOT
						modifier = opinion_friend
					}
				}
			}
			add_friend = root
			opinion = {
				modifier = opinion_friend
				who = ROOT
				years = 100
			}
			character_event = {
				id = druchii_feast.24
			}
		}
	}
}

# Late night talk: Second person
character_event = {
	id = druchii_feast.24
	desc = EVTDESCDRUCHIFEAST.24 # You end up spending half the night talking to this person, and find that you have much in common and can help each other in achieving common goals.
	picture = "GFX_evt_large_army"
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.24 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTDRUCHIFEAST.23.a # I have made a new ally tonight!
		FROM = {
			add_friend = from
			opinion = {
				modifier = opinion_friend
				who = ROOT
				years = 100
			}
		}
	}
}

# Duel: Start
character_event = {
	id = druchii_feast.25
	desc = "EVTDESC72030"
	picture = GFX_evt_melee
	only_men = yes
	min_age = 16
	capable_only = yes
	prisoner = no
	has_character_flag = attending_druchii_feast
	war = no

	trigger = {
		martial = 9
		OR = {
			trait = duelist
			trait = brave
			trait = wroth
			trait = cruel
		}
		nor = {
			trait = wounded
			trait = maimed
			trait = craven
		}
		# think about it
		any_realm_character = {
			same_liege = ROOT
			is_adult = yes
			is_female = no
			has_character_flag = attending_druchii_feast
			nor = {
				character = ROOT
				reverse_opinion = {
					who = ROOT
					value = -50
				}
				opinion = {
					who = ROOT
					value = -50
				}
				trait = wounded
				trait = maimed
			}
		}
	}

	mean_time_to_happen = {
		days = 200
		modifier = {
			factor = 0.5
			trait = brave
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 10
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 20
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 30
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 40
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 50
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 60
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 70
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 80
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 90
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 100
			}
		}
	}

	immediate = {
		log = "work event id = druchii_feast.25 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72030"
		any_realm_character = {
			limit = {
				same_liege = ROOT
				liege = {
					has_character_flag = holding_large_druchi_feast
					has_character_modifier = holding_large_druchi_feast
				}
				is_adult = yes
				is_female = no
				has_character_flag = attending_druchii_feast
				nor = {
					character = ROOT
					trait = wounded
					trait = maimed
					reverse_opinion = {
						who = ROOT
						value = -50
					}
					opinion = {
						who = ROOT
						value = -50
					}
				}
			}
			character_event = {
				id = druchii_feast.26
				tooltip = "EVTTOOLTIP72031"
			}
		}
	}

	option = {
		name = "EVTOPTB72030" # Decline
		prestige = -10
	}
}

# Duel: Accept or Decline
character_event = {
	id = druchii_feast.26
	desc = "EVTDESC72031"
	picture = GFX_evt_melee
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.26 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72031" # Accept
		hidden_tooltip = {
			from = {
				save_event_target_as = duelist_a
				set_character_flag = duel
				set_character_flag = duel_effect_noescape
				set_character_flag = duel_non_battle
			}
			save_event_target_as = duelist_b
			set_character_flag = duel
			set_character_flag = duel_effect_noescape
			set_character_flag = duel_non_battle
			character_event = {
				id = duelengine.1
			}
		}
	}

	option = {
		name = "EVTOPTB72031" # Decline
		prestige = -10
	}
}

# Friendly with another guest's spouse
character_event = {
	id = druchii_feast.50
	desc = "EVTDESC72040"
	picture = "GFX_evt_large_army"
	only_playable = yes
	min_age = 16
	capable_only = yes
	prisoner = no
	has_character_flag = attending_druchii_feast
	war = no

	trigger = {
		fertility = 0.4
		any_realm_character = {
			same_liege = ROOT
			liege = {
				NOT = {
					had_character_flag = {
						flag = holding_large_druchi_feast
						days = 30
					}
				}
				war = no
				has_character_flag = holding_large_druchi_feast
				has_character_modifier = holding_large_druchi_feast
			}
			NOT = {
				character = ROOT
			}
			has_character_flag = attending_druchii_feast
			spouse = {
				prisoner = no
				is_adult = yes
				is_pregnant = no
				is_alive = yes
				is_abroad = no
				nor = {
					trait = celibate
					trait = eunuch
				}
				opinion = {
					who = ROOT
					value = 20
				}
				is_opposite_sex = root
			}
		}
	}

	mean_time_to_happen = {
		days = 240
		modifier = {
			factor = 0.25
			trait = lustful
		}
		modifier = {
			factor = 0.5
			trait = hedonist
		}
		modifier = {
			factor = 10
			trait = chaste
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 10
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 20
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 30
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 40
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 50
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 60
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 70
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 80
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 90
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 100
			}
		}
	}

	immediate = {
		log = "work event id = druchii_feast.50 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72040"
		prestige = -5
	}

	option = {
		name = "EVTOPTB72040"
		random_realm_character = {
			limit = {
				same_liege = ROOT
				liege = {
					has_character_flag = holding_large_druchi_feast
					has_character_modifier = holding_large_druchi_feast
				}
				NOT = {
					character = ROOT
				}
				has_character_flag = attending_druchii_feast
				spouse = {
					prisoner = no
					is_adult = yes
					is_pregnant = no
					is_alive = yes
					is_abroad = no
					nor = {
						trait = celibate
						trait = eunuch
					}
					opinion = {
						who = ROOT
						value = 20
					}
					is_opposite_sex = root
				}
			}
			spouse = {
				character_event = {
					id = druchii_feast.51
					tooltip = "EVTTOOLTIP72041"
				}
			}
		}
	}
}

# Spouse answers the 'invitation'
character_event = {
	id = druchii_feast.51
	desc = "EVTDESC72041d"
	picture = GFX_evt_lovers
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.51 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72041"
		trigger = {
			is_female = yes
		}
		random = {
			chance = 25
			FROM = {
				impregnate = ROOT
				character_event = {
					id = druchii_feast.52
					days = 60
					tooltip = "EVTTOOLTIP72042"
				}
			}
		}
	}

	option = {
		name = "EVTOPTB72041"
		trigger = {
			is_female = no
		}
		random = {
			chance = 25
			impregnate = FROM
			character_event = {
				id = druchii_feast.52
				days = 60
				tooltip = "EVTTOOLTIP72042"
			}
		}
	}

	option = {
		name = "EVTOPTC72041"
		piety = 5
	}
}

# Their night together resulted in a child
character_event = {
	id = druchii_feast.52
	desc = "EVTDESC72042"
	picture = GFX_evt_pregnancy
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.52 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72042"
		FROM = {
			spouse = {
				opinion = {
					modifier = opinion_cuckolded
					who = ROOT
					years = 100
				}
			}
		}
	}
}

# Drink too much wine: become drunkard or insult host
character_event = {
	id = druchii_feast.53
	desc = "EVTDESC72045"
	picture = "GFX_evt_large_army"
	min_age = 16
	capable_only = yes
	prisoner = no
	has_character_flag = attending_druchii_feast
	war = no

	trigger = {
		NOT = {
			trait = drunkard
		}
		any_liege = {
			NOT = {
				had_character_flag = {
					flag = holding_large_druchi_feast
					days = 30
				}
			}
			war = no
			has_character_flag = holding_large_druchi_feast
			has_character_modifier = holding_large_druchi_feast
			NOT = {
				has_character_flag = feast_drunkard_guest
			}
		}
	}

	mean_time_to_happen = {
		days = 240
		modifier = {
			factor = 0.5
			any_liege = {
				any_claim = {
					holder_scope = {
						same_realm = ROOT
					}
				}
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 10
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 20
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 30
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 40
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 50
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 60
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 70
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 80
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 90
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 100
			}
		}
	}

	immediate = {
		log = "work event id = druchii_feast.53 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72045"
		random = {
			chance = 25
			add_trait = drunkard
			hidden_tooltip = {
				character_event = {
					id = 38286 # Notify Drunkard
				}
			}
			any_liege = {
				limit = {
					has_character_flag = holding_large_druchi_feast
					has_character_modifier = holding_large_druchi_feast
				}
				set_character_flag = feast_drunkard_guest
			}
		}
	}

	option = {
		name = "EVTOPTB72045"
		any_liege = {
			limit = {
				has_character_flag = holding_large_druchi_feast
				has_character_modifier = holding_large_druchi_feast
			}
			set_character_flag = feast_drunkard_guest
			character_event = {
				id = druchii_feast.54
				tooltip = "EVTTOOLTIP72052"
			}
		}
	}
}

# Liege is insulted when guest refuses more wine
character_event = {
	id = druchii_feast.54
	desc = "EVTDESC72052"
	picture = GFX_evt_drunk
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.54 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72052"
		opinion = {
			modifier = opinion_insulted
			who = FROM
			years = 10
		}
	}
}

# Drink too much wine: Embarass yourself
character_event = {
	id = druchii_feast.55
	desc = "EVTDESC72046"
	picture = "GFX_evt_large_army"
	min_age = 16
	capable_only = yes
	prisoner = no
	has_character_flag = attending_druchii_feast
	war = no

	trigger = {
		trait = drunkard
		any_liege = {
			NOT = {
				had_character_flag = {
					flag = holding_large_druchi_feast
					days = 30
				}
			}
			war = no
			has_character_flag = holding_large_druchi_feast
			has_character_modifier = holding_large_druchi_feast
			NOT = {
				has_character_flag = feast_drunkard_guest
			}
			any_courtier = {
				has_job_title = job_treasurer
				NOT = {
					trait = drunkard
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 60
	}

	immediate = {
		log = "work event id = druchii_feast.55 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72046"
		any_liege = {
			limit = {
				has_character_flag = holding_large_druchi_feast
				has_character_modifier = holding_large_druchi_feast
				has_character_flag = lavishly_food
			}
			set_character_flag = feast_drunkard_guest
			character_event = {
				id = druchii_feast.56
				tooltip = "EVTTOOLTIP72047"
			}
			random_courtier = {
				limit = {
					has_job_title = job_treasurer
					NOT = {
						trait = drunkard
					}
				}
				opinion = {
					modifier = opinion_dislike
					who = ROOT
					years = 10
				}
			}
		}
	}
}

# Host is not happy about drunkard falling asleep
character_event = {
	id = druchii_feast.56
	desc = "EVTDESC72047"
	picture = GFX_evt_drunk
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.56 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72047"
		opinion = {
			modifier = opinion_disgusted
			who = FROM
			years = 10
		}
	}
}

# Drink too much wine: Fall asleep
character_event = {
	id = druchii_feast.57
	desc = "EVTDESC72048"
	picture = "GFX_evt_large_army"
	min_age = 16
	capable_only = yes
	prisoner = no
	has_character_flag = attending_druchii_feast
	war = no

	trigger = {
		trait = drunkard
		any_liege = {
			NOT = {
				had_character_flag = {
					flag = holding_large_druchi_feast
					days = 30
				}
			}
			war = no
			has_character_flag = holding_large_druchi_feast
			has_character_modifier = holding_large_druchi_feast
			NOT = {
				has_character_flag = feast_drunkard_guest
			}
		}
	}

	mean_time_to_happen = {
		days = 60
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 10
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 20
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 30
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 40
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 50
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 60
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 70
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 80
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 90
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 100
			}
		}
	}

	immediate = {
		log = "work event id = druchii_feast.57 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72048"
		prestige = -10
		any_liege = {
			limit = {
				has_character_flag = holding_large_druchi_feast
				has_character_modifier = holding_large_druchi_feast
				has_character_flag = lavishly_food
			}
			set_character_flag = feast_drunkard_guest
			character_event = {
				id = druchii_feast.58
				tooltip = "EVTTOOLTIP72049"
			}
		}
	}
}

# Host is not happy about drunkard falling asleep
character_event = {
	id = druchii_feast.58
	desc = "EVTDESC72049"
	picture = GFX_evt_drunk
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.58 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72049"
		opinion = {
			modifier = opinion_disgusted
			who = FROM
			years = 10
		}
	}
}

# Highway Robber Band: Guest Complains
character_event = {
	id = druchii_feast.59
	desc = "EVTDESC72050"
	picture = GFX_evt_bandits
	min_age = 16
	capable_only = yes
	prisoner = no
	has_character_flag = attending_druchii_feast
	war = no

	trigger = {
		any_liege = {
			NOT = {
				had_character_flag = {
					flag = holding_large_druchi_feast
					days = 30
				}
			}
			war = no
			has_character_flag = holding_large_druchi_feast
			has_character_modifier = holding_large_druchi_feast
			location = {
				has_province_modifier = highway_robber_band
			}
		}
	}

	mean_time_to_happen = {
		days = 60
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 10
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 20
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 30
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 40
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 50
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 60
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 70
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 80
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 90
			}
		}
		modifier = {
			factor = 2
			liege = {
				num_of_vassals = 100
			}
		}
	}

	immediate = {
		log = "work event id = druchii_feast.59 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72050"
		any_liege = {
			limit = {
				has_character_flag = holding_large_druchi_feast
				has_character_modifier = holding_large_druchi_feast
				location = {
					has_province_modifier = highway_robber_band
				}
			}
			character_event = {
				id = druchii_feast.60
				tooltip = "EVTTOOLTIP72051"
			}
		}
	}
}

# Highway Robber Band: The End
character_event = {
	id = druchii_feast.60
	desc = "EVTDESC72051"
	picture = GFX_evt_bandits
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.60 for [Root.GetBestName]"
	}

	option = {
		name = "EVTOPTA72051"
		FROM = {
			opinion = {
				modifier = opinion_dislike
				who = ROOT
				years = 10
			}
		}
	}
}

# Invite vassals to feast
character_event = {
	id = druchii_feast.1000
	desc = EVTDESC_druchifeast_1000
	picture = GFX_evt_emissary
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1000 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1000
		any_vassal = {
			limit = {
				age = 16
				prisoner = no
				war = no
				in_command = no
				NOT = {
					trait = incapable
					has_character_flag = do_not_disturb
				}
			}
			letter_event = {
				id = druchii_feast.1940
				tooltip = EVTTOOLTIP1_druchifeast_1000
			}
		}
		if = {
			limit = {
				is_married = yes
			}
			hidden_tooltip = {
				character_event = {
					id = druchii_feast.1005
				}
			}
		}
		if = {
			limit = {
				is_married = no
				has_lover = yes
			}
			hidden_tooltip = {
				character_event = {
					id = druchii_feast.1006
				}
			}
		}
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1020 days = 12
			}
		}
	}
}

# Vassal receives invitation
letter_event = {
	id = druchii_feast.1940
	desc = EVTDESC_druchifeast_1940
	picture = GFX_evt_emissary
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1940 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1001 # Travel to the feast
		ai_chance = {
			factor = 2
			modifier = {
				factor = 5
				has_focus = focus_carousing
			}
			modifier = {
				factor = 0.1
				trait = in_hiding
			}
			modifier = {
				factor = 2
				opinion = {
					who = from
					value = -30
				}
			}
			modifier = {
				factor = 5
				opinion = {
					who = from
					value = -15
				}
			}
			modifier = {
				factor = 5
				opinion = {
					who = from
					value = 0
				}
			}
		}
		set_character_flag = do_not_disturb
		# Hidden - arrives at feast
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1989 days = 12
			}
		}
		# Safety event for clearing all flags
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1990 days = 42
			}
		}
		if = {
			limit = {
				is_married = yes
			}
			hidden_tooltip = {
				character_event = {
					id = druchii_feast.1005
				}
			}
		}
		if = {
			limit = {
				is_married = no
				has_lover = yes
			}
			hidden_tooltip = {
				character_event = {
					id = druchii_feast.1006
				}
			}
		}
		if = {
			limit = {
				trait = in_hiding
			}
			remove_trait = in_hiding
			add_character_modifier = {
				name = went_out_of_hiding_timer
				duration = 180
				hidden = yes
			}
			# Notify plotters and family
			hidden_tooltip = {
				character_event = {
					id = CM.6400
				}
			}
		}
	}

	option = {
		name = EVTOPTB_druchifeast_1001 # Refuse invitation
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				opinion = {
					who = from
					value = 25
				}
			}
		}
		FROM = {
			letter_event = {
				id = druchii_feast.1002
				days = 3
				tooltip = EVTTOOLTIP1_druchifeast_2001
			}
		}
	}
}

# If vassal refuses to come to the feast
letter_event = {
	id = druchii_feast.1002
	desc = EVTDESC_druchifeast_1002
	picture = GFX_evt_emissary
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1002 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1002
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 2
		}
	}
}

# Choose gift for spouse
character_event = {
	id = druchii_feast.1005
	desc = EVTDESC_druchifeast_1005
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1005 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1005
		trigger = {
			spouse = {
				is_female = yes
			}
		}
		scaled_wealth = -0.2
		set_character_flag = druchii_feast_fine_gift_to_spouse
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007 days = 30
			}
		}
	}

	option = {
		name = EVTOPTB_druchifeast_1005
		trigger = {
			spouse = {
				is_female = yes
			}
		}
		scaled_wealth = -0.05
		set_character_flag = druchii_feast_small_gift_to_spouse
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007 days = 30
			}
		}
	}

	option = {
		name = EVTOPTC_druchifeast_1005
		trigger = {
			NOT = {
				trait = kind
			}
			spouse = {
				is_female = yes
			}
		}
		set_character_flag = druchii_feast_no_gift_to_spouse
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007 days = 30
			}
		}
	}

	option = {
		name = EVTOPTD_druchifeast_1005
		trigger = {
			has_lover = yes
			spouse = {
				NOT = {
					is_lover = ROOT
				}
				is_female = yes
			}
		}
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1006
			}
		}
	}

	option = {
		name = EVTOPTE_druchifeast_1005
		trigger = {
			spouse = {
				is_female = no
			}
		}
		scaled_wealth = -0.2
		set_character_flag = druchii_feast_fine_gift_to_spouse
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007 days = 30
			}
		}
	}

	option = {
		name = EVTOPTF_druchifeast_1005
		trigger = {
			spouse = {
				is_female = no
			}
		}
		scaled_wealth = -0.05
		set_character_flag = druchii_feast_small_gift_to_spouse
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007 days = 30
			}
		}
	}

	option = {
		name = EVTOPTG_druchifeast_1005
		trigger = {
			NOT = {
				trait = kind
			}
			spouse = {
				is_female = no
			}
		}
		set_character_flag = druchii_feast_no_gift_to_spouse
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007 days = 30
			}
		}
	}

	option = {
		name = EVTOPTH_druchifeast_1005
		trigger = {
			has_lover = yes
			spouse = {
				NOT = {
					is_lover = ROOT
				}
				is_female = no
			}
		}
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1006
			}
		}
	}
}

# Choose gift for lover
character_event = {
	id = druchii_feast.1006
	desc = EVTDESC_druchifeast_1006
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1006 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1006
		trigger = {
			any_lover = {
				is_female = yes
			}
		}
		scaled_wealth = -0.2
		set_character_flag = druchii_feast_fine_gift_to_lover
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007 days = 30
			}
		}
	}

	option = {
		name = EVTOPTB_druchifeast_1006
		trigger = {
			any_lover = {
				is_female = yes
			}
		}
		scaled_wealth = -0.05
		set_character_flag = druchii_feast_small_gift_to_lover
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007 days = 30
			}
		}
	}

	option = {
		name = EVTOPTC_druchifeast_1006
		trigger = {
			is_married = no
			NOT = {
				trait = kind
			}
			any_lover = {
				is_female = yes
			}
		}
		set_character_flag = druchii_feast_no_gift_to_lover
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007
				days = 30
			}
		}
	}

	option = {
		name = EVTOPTD_druchifeast_1006
		trigger = {
			any_lover = {
				is_female = no
			}
		}
		scaled_wealth = -0.2
		set_character_flag = druchii_feast_fine_gift_to_lover
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007
				days = 30
			}
		}
	}

	option = {
		name = EVTOPTE_druchifeast_1006
		trigger = {
			any_lover = {
				is_female = no
			}
		}
		scaled_wealth = -0.05
		set_character_flag = druchii_feast_small_gift_to_lover
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007
				days = 30
			}
		}
	}

	option = {
		name = EVTOPTF_druchifeast_1006
		trigger = {
			is_married = no
			NOT = {
				trait = kind
			}
			any_lover = {
				is_female = no
			}
		}
		set_character_flag = druchii_feast_no_gift_to_lover
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1007
				days = 30
			}
		}
	}
}

# Wife or lover reacts to gift (or lack thereof)
character_event = {
	id = druchii_feast.1007
	desc = EVTDESC_druchifeast_1007
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1007 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1007
		trigger = {
			spouse = {
				is_female = yes
			}
			has_character_flag = druchii_feast_fine_gift_to_spouse
		}
		spouse = {
			opinion = {
				modifier = opinion_grateful
				who = ROOT
				years = 1
			}
			random = {
				chance = 30
				add_lover = ROOT
			}
		}
	}

	option = {
		name = EVTOPTB_druchifeast_1007
		trigger = {
			spouse = {
				is_female = yes
			}
			has_character_flag = druchii_feast_small_gift_to_spouse
		}
	}

	option = {
		name = EVTOPTC_druchifeast_1007
		trigger = {
			spouse = {
				is_female = yes
			}
			has_character_flag = druchii_feast_no_gift_to_spouse
		}
		spouse = {
			opinion = {
				modifier = opinion_insulted
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTD_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = yes
			}
			has_character_flag = druchii_feast_fine_gift_to_lover
			is_married = yes
		}
		random_lover = {
			opinion = {
				modifier = opinion_very_grateful
				who = ROOT
				years = 1
			}
		}
		spouse = {
			opinion = {
				modifier = opinion_furious
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTE_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = yes
			}
			has_character_flag = druchii_feast_fine_gift_to_lover
			is_married = no
		}
		random_lover = {
			opinion = {
				modifier = opinion_very_grateful
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTF_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = yes
			}
			has_character_flag = druchii_feast_small_gift_to_lover
			is_married = yes
		}
		random_lover = {
			opinion = {
				modifier = opinion_grateful
				who = ROOT
				years = 1
			}
		}
		spouse = {
			opinion = {
				modifier = opinion_insulted
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTG_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = yes
			}
			has_character_flag = druchii_feast_small_gift_to_lover
			is_married = no
		}
		random_lover = {
			opinion = {
				modifier = opinion_grateful
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTH_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = yes
			}
			has_character_flag = druchii_feast_no_gift_to_lover
		}
		random_lover = {
			opinion = {
				modifier = opinion_disappointed
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTI_druchifeast_1007
		trigger = {
			spouse = {
				is_female = no
			}
			has_character_flag = druchii_feast_fine_gift_to_spouse
		}
		spouse = {
			opinion = {
				modifier = opinion_grateful
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTJ_druchifeast_1007
		trigger = {
			spouse = {
				is_female = no
			}
			has_character_flag = druchii_feast_small_gift_to_spouse
		}
	}

	option = {
		name = EVTOPTK_druchifeast_1007
		trigger = {
			spouse = {
				is_female = no
			}
			has_character_flag = druchii_feast_no_gift_to_spouse
		}
		spouse = {
			opinion = {
				modifier = opinion_insulted
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTL_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = no
			}
			has_character_flag = druchii_feast_fine_gift_to_lover
			is_married = yes
		}
		random_lover = {
			opinion = {
				modifier = opinion_very_grateful
				who = ROOT
				years = 1
			}
		}
		spouse = {
			opinion = {
				modifier = opinion_furious
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTM_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = no
			}
			has_character_flag = druchii_feast_fine_gift_to_lover
			is_married = no
		}
		random_lover = {
			opinion = {
				modifier = opinion_very_grateful
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTN_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = no
			}
			has_character_flag = druchii_feast_small_gift_to_lover
			is_married = yes
		}
		random_lover = {
			opinion = {
				modifier = opinion_grateful
				who = ROOT
				years = 1
			}
		}
		spouse = {
			opinion = {
				modifier = opinion_insulted
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTO_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = no
			}
			has_character_flag = druchii_feast_small_gift_to_lover
			is_married = no
		}
		random_lover = {
			opinion = {
				modifier = opinion_grateful
				who = ROOT
				years = 1
			}
		}
	}

	option = {
		name = EVTOPTP_druchifeast_1007
		trigger = {
			any_lover = {
				is_female = no
			}
			has_character_flag = druchii_feast_no_gift_to_lover
		}
		random_lover = {
			opinion = {
				modifier = opinion_disappointed
				who = ROOT
				years = 1
			}
		}
	}
}

# Feast beginning and ending
# ID druchifeast.1020, druchifeast.1095-druchifeast.1099
# Feast begins
character_event = {
	id = druchii_feast.1020
	desc = EVTDESC_druchifeast_1020
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1020 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1020
		# Religious ceremony
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1170
				days = 25
			}
		}
		# End feast
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1995
				days = 30
			}
		}
		# Clearing all flags and modifiers after feast
		hidden_tooltip = {
			character_event = {
				id = druchii_feast.1990
				days = 31
			}
		}
		set_character_flag = druchii_feast_begun
		hidden_tooltip = {
			random_list = {
				# Choose random event
				10 = {
					character_event = {
						id = druchii_feast.1050 days = 10 random = 5
					}
				} # Beastmaster and Manticore
				# 2 = { character_event = { id = druchii_feast.1140 days = 10 random = 5 } } # Apsara
				# 2 = { character_event = { id = druchii_feast.1143 days = 10 random = 5 } } # Ghandarva
				# 10 = { character_event = { id = druchii_feast.1150 days = 10 random = 5 } } # Sorceress and Slave
				# 10 = { character_event = { id = druchii_feast.1160 days = 10 random = 5 } } # Monkeys
				100 = {
				} # No random event
			}
		}
		any_courtier = {
			limit = {
				is_adult = yes
				is_ruler = no
				NOT = {
					trait = incapable
				}
			}
			set_character_flag = attending_druchii_feast
			# Clearing all flags and modifiers after feast
			hidden_tooltip = {
				character_event = {
					id = druchii_feast.1990
					days = 31
				}
			}
		}
	}
}

# Vassal arrives at feast
character_event = {
	id = druchii_feast.1989
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1989 for [Root.GetBestName]"
		set_character_flag = attending_druchii_feast
	}
}

# Feast ends
character_event = {
	id = druchii_feast.1995
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1995 for [Root.GetBestName]"
		if = {
			limit = {
				has_character_flag = bad_druchii_feast
			}
			character_event = {
				id = druchii_feast.1997
			}
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = bad_druchii_feast
				}
			}
			character_event = {
				id = druchii_feast.1996
			}
		}
		any_vassal = {
			limit = {
				has_character_flag = attending_druchii_feast
				ROOT = {
					is_liege_of = THIS
				}
				has_character_flag = bad_druchii_feast
			}
			character_event = {
				id = druchii_feast.1999
			}
		}
		any_vassal = {
			limit = {
				has_character_flag = attending_druchii_feast
				ROOT = {
					is_liege_of = THIS
				}
				NOT = {
					has_character_flag = bad_druchii_feast
				}
			}
			character_event = {
				id = druchii_feast.1998
			}
		}
	}
}

# A feast to remember - host
character_event = {
	id = druchii_feast.1996
	desc = EVTDESC_druchifeast_1996
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1996 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1996
		add_character_modifier = {
			name = large_feast_timer
			duration = 365
			hidden = yes
		}
	}
}

# A feast to forget - host
character_event = {
	id = druchii_feast.1997
	desc = EVTDESC_druchifeast_1997
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1997 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1997
		add_character_modifier = {
			name = large_feast_timer
			duration = 365
			hidden = yes
		}
	}
}

# A feast to remember - guest
character_event = {
	id = druchii_feast.1998
	desc = EVTDESC_druchifeast_1998
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1998 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1998
		add_character_modifier = {
			name = large_feast_timer
			duration = 365
			hidden = yes
		}
	}
}

# A feast to forget - guest
character_event = {
	id = druchii_feast.1999
	desc = EVTDESC_druchifeast_1999
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1999 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1999
		add_character_modifier = {
			name = large_feast_timer
			duration = 365
			hidden = yes
		}
	}
}

# Random events at feast
# ID druchifeast.1050-druchifeast.
# Snake charmer
character_event = {
	id = druchii_feast.1050
	desc = EVTDESC_druchifeast_1050
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1050 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1050
		hidden_tooltip = {
			random = {
				chance = 50
				character_event = {
					id = druchii_feast.1051
				}
			}
		}
		set_character_flag = druchii_feast_snake_charmer
	}
}

# Snake charmer - snake escapes!
character_event = {
	id = druchii_feast.1051
	desc = EVTDESC_druchifeast_1051
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1051 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1051
		hidden_tooltip = {
			random_list = {
				10 = {
					character_event = {
						id = druchii_feast.1052
					}
				}
				10 = {
					character_event = {
						id = druchii_feast.1054
					}
				}
				10 = {
					character_event = {
						id = druchii_feast.1055
					}
				}
			}
		}
	}
}

# Snake slither up in someone's lap and scares them
character_event = {
	id = druchii_feast.1052
	desc = EVTDESC_druchifeast_1052
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1052 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1052
		random_realm_character = {
			limit = {
				has_character_flag = attending_druchii_feast
				ROOT = {
					is_liege_of = THIS
				}
			}
			hidden_tooltip = {
				character_event = {
					id = druchii_feast.1053
				}
			}
		}
	}
}

# Notify target of friendly snake
character_event = {
	id = druchii_feast.1053
	desc = EVTDESC_druchifeast_1053
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1053 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1053
		if = {
			limit = {
				nor = {
					trait = stressed
					trait = craven
				}
			}
			add_trait = stressed
			set_character_flag = bad_druchii_feast
		}
		if = {
			limit = {
				OR = {
					trait = stressed
					trait = craven
				}
			}
			hidden_tooltip = {
				random_list = {
					10 = {
						add_trait = ill
						set_character_flag = bad_druchii_feast
						character_event = {
							id = 38290
						} # Notify
					}
					10 = {
						add_trait = stutter
						set_character_flag = bad_druchii_feast
						character_event = {
							id = 38253
						} # Notify
					}
					10 = {
						add_trait = depressed
						set_character_flag = bad_druchii_feast
						character_event = {
							id = 38288
						} # Notify
					}
					10 = {
						add_trait = lunatic
						set_character_flag = bad_druchii_feast
						character_event = {
							id = 38304
						} # Notify
					}
				}
			}
		}
	}
}

# Snake kills guest
character_event = {
	id = druchii_feast.1054
	desc = EVTDESC_druchifeast_1054
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1054 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1054
		random_realm_character = {
			limit = {
				has_character_flag = attending_druchii_feast
				ROOT = {
					is_liege_of = THIS
				}
				ai = yes
			}
			death = {
				death_reason = death_accident
			}
		}
	}
}

# Guest kills snake
character_event = {
	id = druchii_feast.1055
	desc = EVTDESC_druchifeast_1055
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1055 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1054
		random_realm_character = {
			limit = {
				has_character_flag = attending_druchii_feast
				ROOT = {
					is_liege_of = THIS
				}
				is_female = no
			}
			tooltip = {
				prestige = 30
			}
			ROOT = {
				opinion = {
					modifier = opinion_impressed
					who = PREV
					years = 5
				}
				any_realm_character = {
					limit = {
						has_character_flag = attending_druchii_feast
						ROOT = {
							is_liege_of = THIS
						}
						NOT = {
							character = PREVPREV
						}
					}
					hidden_tooltip = {
						opinion = {
							modifier = opinion_impressed
							who = PREVPREV
							years = 5
						}
					}
				}
			}
			hidden_tooltip = {
				character_event = {
					id = druchii_feast.1056
				}
			}
		}
	}
}

# Notify hero killer of snake
character_event = {
	id = druchii_feast.1056
	desc = EVTDESC_druchifeast_1056
	picture = GFX_evt_feast
	is_triggered_only = yes

	immediate = {
		log = "work event id = druchii_feast.1056 for [Root.GetBestName]"
	}

	option = {
		name = EVTOPTA_druchifeast_1056
		prestige = 30
	}
}

###########################################
# Flag management                         #
###########################################

# Clear all character flags and modifiers
character_event = {
	id = druchii_feast.1990

	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = holding_large_druchi_feast
		clr_character_flag = attending_druchii_feast
		clr_character_flag = druchii_feast_begun
		clr_character_flag = druchii_feast_monkeys
		clr_character_flag = druchii_feast_snake_charmer
		clr_character_flag = druchii_feast_fine_gift_to_spouse
		clr_character_flag = druchii_feast_small_gift_to_spouse
		clr_character_flag = druchii_feast_no_gift_to_spouse
		clr_character_flag = druchii_feast_fine_gift_to_lover
		clr_character_flag = druchii_feast_small_gift_to_lover
		clr_character_flag = druchii_feast_apsara
		clr_character_flag = druchii_feast_gandharva
		clr_character_flag = druchii_feast_magician
		clr_character_flag = druchii_feast_religious_ceremony
		clr_character_flag = sent_invitations
		clr_character_flag = holding_large_druchi_feast
		clr_character_flag = feast_jongleur
		clr_character_flag = feast_musicians
		clr_character_flag = feast_minstrel
		clr_character_flag = feast_fireeaters
		clr_character_flag = feast_conjurer
		clr_character_flag = lavishly_food
		clr_character_flag = medium_food
		clr_character_flag = low_food
		clr_character_flag = castle_problems
		clr_character_flag = feast_jester 
		clr_character_flag = feast_drunkard_guest
		clr_character_flag = druchi_feast_duel
		clr_character_flag = feast_boar_hunt
		clr_character_flag = coming_to_feast
		clr_character_flag = wounded_opponent
		clr_character_flag = maimed_opponent
		clr_character_flag = killed_opponent
		clr_character_flag = bad_druchii_feast
		clr_character_flag = do_not_disturb
	}
}
